---
alwaysApply: true




# Carcosa Project Hierarchy & Ownership Model

## ðŸ—ï¸ Core Architecture Principles

Carcosa follows a **3-tier ownership model**: Organization â†’ Team â†’ Project, similar to GitHub, Vercel, and other modern SaaS platforms.

## ðŸ§© Ownership Breakdown

### ðŸŒ Organization Level (Infra & Governance)
- **Buckets** â†’ Costly infrastructure, credentials, billing responsibility
- **Audit Logs** â†’ Compliance and governance across the organization  
- **Usage Analytics** â†’ Billing and analytics are organization-wide
- **Organization Settings** â†’ Billing plans, API limits, branding, security policies

### ðŸ‘¥ Team Level (Collaboration & Apps)
- **Apps/Projects** â†’ Teams are where people collaborate, each app belongs to a team
- **Tenants** â†’ Multi-tenant sub-clients of a project (scoped to specific apps)
- **Transforms** â†’ Image/file processing workflows (part of app functionality)
- **Team Settings** â†’ Team-specific configurations, member management

### ðŸ‘¤ User Level (Personal)
- **Account Profile** â†’ Password, 2FA, notifications, personal preferences
- **Memberships** â†’ User's roles across organizations and teams

## ðŸ§­ Navigation Hierarchy

### Top Level (Organization Context)
```
[Org Switcher: ACME Corp] [User Avatar]

Overview
â”œâ”€â”€ Teams
â”‚   â”œâ”€â”€ Backend Team
â”‚   â”œâ”€â”€ Frontend Team  
â”‚   â””â”€â”€ Marketing Team
â”œâ”€â”€ Buckets
â”œâ”€â”€ Usage
â”œâ”€â”€ Audit Logs
â””â”€â”€ Settings
```

### Team Level (Team Context)
```
[Team: Backend Team]

Apps/Projects
â”œâ”€â”€ Tenants
â”œâ”€â”€ Transforms  
â”œâ”€â”€ Files
â””â”€â”€ Settings
```

### Project/App Level (Project Context)
```
[App: E-commerce API]

Back to Apps
â”œâ”€â”€ Overview
â”œâ”€â”€ Files
â”œâ”€â”€ Tenants
â”œâ”€â”€ API Keys
â”œâ”€â”€ Transforms
â”œâ”€â”€ Usage (scoped to project)
â”œâ”€â”€ Audit Logs (scoped to project)
â””â”€â”€ Settings
```

## ðŸ”„ Bucket Sharing Model

### Ownership vs Access
- **Ownership**: Organization owns all buckets (billing, credentials, governance)
- **Access**: Teams get granted access via `BucketTeamAccess` model
- **Usage**: Projects must use buckets their team has access to

### Access Levels
- **READ_ONLY**: Project can fetch files, no uploads
- **READ_WRITE**: Full file lifecycle (upload, delete, transform)  
- **ADMIN**: Can manage bucket sharing (invite/remove teams)

### Workflow
1. **Org Admin** creates bucket with provider credentials
2. **Org Admin** grants team access with specific permission levels
3. **Team Members** create projects using accessible buckets
4. **System** enforces access control and audit logging

## ðŸ“ File Path Isolation

When teams share buckets, files are isolated using structured paths:
```
/{organizationSlug}/{teamSlug}/{projectSlug}/{filename}
```

Examples:
- `acme-corp/backend-team/ecommerce-api/user-avatar.jpg`
- `acme-corp/marketing-team/landing-page/hero-image.png`

## ðŸ”‘ Key Implementation Details

### Database Models
- `Organization` â†’ Top-level entity
- `Team` â†’ Belongs to organization, has members
- `Bucket` â†’ Owned by organization, shared with teams via `BucketTeamAccess`
- `Project` â†’ Belongs to team, uses accessible buckets
- `BucketTeamAccess` â†’ Many-to-many relationship with access levels

### API Patterns
- Organization-scoped: `/api/v1/organizations/{orgId}/buckets`
- Team-scoped: `/api/v1/teams/{teamId}/projects`
- Project-scoped: `/api/v1/projects/{projectId}/files`

### Access Control
- All API endpoints verify user membership in relevant org/team
- Bucket operations check `BucketTeamAccess` permissions
- File operations include org/team/project path prefixes

## ðŸŽ¯ Benefits

1. **Clear Separation**: Infrastructure (buckets) vs. applications (projects)
2. **Flexible Sharing**: Buckets can be shared across teams with granular permissions
3. **Proper Isolation**: File paths prevent team data conflicts
4. **Audit Trail**: All access and operations are logged with proper context
5. **Scalable**: Supports single-team orgs and large multi-team enterprises
6. **Industry Standard**: Follows patterns users expect from GitHub, Vercel, etc.

## ðŸš¦ UI/UX Principles

- **Context Switching**: Clear org/team switchers in header
- **Breadcrumbs**: Show hierarchy path (Org > Team > Project > Page)
- **Scoped Navigation**: Menu items change based on current context
- **Access Indicators**: Show user's role and permissions clearly
- **Progressive Disclosure**: Hide complexity until needed

This hierarchy ensures users always understand "where they are" and "what they can do" in the system.


---
